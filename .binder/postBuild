#!/bin/bash

# Ensure the script is executable
chmod +x "${0}"

# Set paths
export PATH="${HOME}/.local/bin:${PATH}"

# for pdf image exports
wget --output-document ~/.local/bin/magick.rpm https://imagemagick.org/archive/linux/CentOS/x86_64/ImageMagick-7.1.1-47.x86_64.rpm
wget --output-document ~/.local/bin/magick-libs.rpm https://imagemagick.org/archive/linux/CentOS/x86_64/ImageMagick-libs-7.1.1-47.x86_64.rpm
alien ~/.local/bin/magick.rpm && alien ~/.local/bin/magick-libs.rpm
rm -rf ~/.local/bin/*.rpm && dpkg -i ~/.local/bin/*.deb

apt update
apt-get install cargo/stable -y 
cargo install --locked typst-cli

# Install Plotly JupyterLab extension
jupyter labextension install jupyterlab-plotly --no-build || echo "Failed to install Plotly extension"

## Find and convert notebooks to MyST if needed
#find . -name "*.ipynb" -not -path "*/\.*" -exec jupytext --to myst {} \; || echo "No notebooks to convert"

## Initialize MyST environment (with error handling)
#myst init || echo "MyST initialization failed"

## Build JupyterLab (with error handling)
#jupyter lab build || echo "JupyterLab build failed"

echo "postBuild script completed"
