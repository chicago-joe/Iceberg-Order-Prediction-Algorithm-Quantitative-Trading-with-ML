
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>FeatureEngineeringVisual</title></head>
<body>
<div id="root"><div style="font-family:Arial, sans-serif;padding:20px;max-width:100%;background-color:#f9f9f9;border-radius:8px;border:1px solid #e0e0e0"><h2 style="color:#333;margin-bottom:20px">Feature Engineering Deep Dive</h2><div style="background-color:white;padding:15px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px;border:1px solid #e0e0e0"><h3 style="border-bottom:2px solid #4a90e2;padding-bottom:8px;margin-bottom:15px;color:#4a90e2;font-weight:bold">Order Book Position Features</h3><table style="width:100%;border-collapse:collapse;margin-top:10px;font-size:14px"><thead><tr><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Feature</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Description</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Trading Significance</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Importance</th></tr></thead><tbody><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>ticksFromSupportLevel</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">np.where(df.isBid==True, df[&#x27;ticksFromLow&#x27;], df[&#x27;ticksFromHigh&#x27;])</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Distance from local support level, determined by order direction<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>For a Buy order: 5 ticks above the lowest recent price
For a Sell order: 7 ticks below the highest recent price</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Orders closer to support levels (for buys) have higher fill probability due to price bounces</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:92px;background-color:rgba(74, 144, 226, 0.92)"></div></div></td></tr><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>ticksFromResistanceLevel</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">np.where(df.isBid!=True, df[&#x27;ticksFromLow&#x27;], df[&#x27;ticksFromHigh&#x27;])</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Distance from local resistance level, determined by order direction<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>For a Buy order: 12 ticks below the highest recent price
For a Sell order: 3 ticks above the lowest recent price</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Orders closer to resistance levels (for sells) have higher fill probability due to price reversals</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:88px;background-color:rgba(74, 144, 226, 0.88)"></div></div></td></tr></tbody></table></div><div style="background-color:white;padding:15px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px;border:1px solid #e0e0e0"><h3 style="border-bottom:2px solid #4a90e2;padding-bottom:8px;margin-bottom:15px;color:#4a90e2;font-weight:bold">Market Imbalance Features</h3><table style="width:100%;border-collapse:collapse;margin-top:10px;font-size:14px"><thead><tr><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Feature</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Description</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Trading Significance</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Importance</th></tr></thead><tbody><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>oneStateBeforeFill_90sec_tradeImbalance</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">flattened_df.columns=flattened_df.columns.map(&quot;_&quot;.join).to_series().apply(lambda x:f&quot;{col}_&quot;+x).tolist()</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Trade imbalance (buys vs sells) over 90-second window before fill state<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>Value: 0.557 (more buying pressure than selling in 90-second window)</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Higher same-sided trade imbalance correlates with increased order fill probability</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:75px;background-color:rgba(74, 144, 226, 0.75)"></div></div></td></tr><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>oneStateBeforeFill_sameSideImbalance</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">df[col.replace(&quot;bid&quot;,&quot;sameSide&quot;)] = np.where(df.isBid==True, df[col], 1-df[col])</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Order book imbalance relative to the order&#x27;s side (buy/sell)<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>Buy order with book imbalance tilted toward buys: 0.72
Sell order with book imbalance tilted toward sells: 0.65</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Stronger book imbalance on same side means harder to get filled, unless iceberg is using it as cover</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:81px;background-color:rgba(74, 144, 226, 0.81)"></div></div></td></tr></tbody></table></div><div style="background-color:white;padding:15px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px;border:1px solid #e0e0e0"><h3 style="border-bottom:2px solid #4a90e2;padding-bottom:8px;margin-bottom:15px;color:#4a90e2;font-weight:bold">Order Dynamics Features</h3><table style="width:100%;border-collapse:collapse;margin-top:10px;font-size:14px"><thead><tr><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Feature</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Description</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Trading Significance</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Importance</th></tr></thead><tbody><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>oneStateBeforeFill_fillToDisplayRatio</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">flattened_dfNumOrders = pd.concat([df.T.stack().reset_index(level=1, drop=True) for df in expandedNumOrders], axis=1)</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Ratio of filled quantity to displayed quantity in the order book<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>Value: 15.0 (15 times more quantity executed than visible on the book)</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Higher ratios indicate aggressive icebergs that are more likely to complete execution</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:85px;background-color:rgba(74, 144, 226, 0.85)"></div></div></td></tr><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>oneStateBeforeFill_leanOverHedgeRatio</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">filtered_dfQty.columns=filtered_dfQty.columns.to_series().apply(lambda x:x+&quot;Qty&quot;).tolist()</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Ratio of directional pressure from hedging activity<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>Value: 0.75 (moderate hedging pressure in direction of order)</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Stronger hedging flows increase likelihood of order execution completion</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:77px;background-color:rgba(74, 144, 226, 0.77)"></div></div></td></tr></tbody></table></div><div style="background-color:white;padding:15px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px;border:1px solid #e0e0e0"><h3 style="border-bottom:2px solid #4a90e2;padding-bottom:8px;margin-bottom:15px;color:#4a90e2;font-weight:bold">Temporal Features</h3><table style="width:100%;border-collapse:collapse;margin-top:10px;font-size:14px"><thead><tr><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Feature</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Description</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Trading Significance</th><th style="background-color:#f5f5f5;padding:10px;text-align:left;border-bottom:1px solid #ddd;font-weight:bold">Importance</th></tr></thead><tbody><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>firstNoticeDays</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">df.apply(lambda row: firstNoticeDays(row[&#x27;expirationMonthYear&#x27;], row[&#x27;tradeDate&#x27;]), axis=1)</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Days until the first notice date for the futures contract<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>Value: 28 (28 days until contract first notice date)</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Orders closer to expiration often have higher execution urgency and completion rates</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:70px;background-color:rgba(74, 144, 226, 0.7)"></div></div></td></tr><tr><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><strong>numAggressivePriceChanges</strong><div style="margin-top:8px"><span style="font-family:monospace;background-color:#f5f5f5;padding:2px 4px;border-radius:3px;font-size:13px">[Original feature from dataset]</span></div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">Count of aggressive price movements in the direction of the order<div style="background-color:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;border:1px solid #d0e3f0;font-size:14px"><strong>Example:</strong><br/>Value: 3 (three aggressive price moves in order direction)</div></td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top">More aggressive price action indicates stronger directional conviction and higher fill probability</td><td style="padding:10px;border-bottom:1px solid #ddd;vertical-align:top"><div style="display:flex;margin-top:5px;align-items:center"><div style="margin-right:10px;font-size:13px;width:100px">Predictive Power:</div><div style="height:8px;border-radius:4px;width:68px;background-color:rgba(74, 144, 226, 0.68)"></div></div></td></tr></tbody></table></div><div style="background-color:white;padding:15px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px;border:1px solid #e0e0e0"><h3 style="border-bottom:2px solid #4a90e2;padding-bottom:8px;margin-bottom:15px;color:#4a90e2;font-weight:bold">Feature Transformation Examples</h3><div><h4>Example 1: Side-Relative Order Book Imbalance</h4><div style="display:flex;align-items:center;margin:15px 0;gap:15px"><div style="flex:1;background-color:white;padding:10px;border-radius:5px;border:1px solid #ddd;min-height:80px"><div style="font-weight:bold;margin-bottom:5px;font-size:14px">Raw Book Data</div><pre style="margin:0;white-space:pre-wrap">Buy/Sell Imbalance: 0.75 (bid)
Ask Volume: 25
Bid Volume: 75</pre></div><div style="font-size:24px;color:#4a90e2">→</div><div style="flex:1;background-color:white;padding:10px;border-radius:5px;border:1px solid #ddd;min-height:80px"><div style="font-weight:bold;margin-bottom:5px;font-size:14px">Consider Order Side</div><pre style="margin:0;white-space:pre-wrap">Order Type: SELL
Imbalance in raw form is not directly useful for the model</pre></div><div style="font-size:24px;color:#4a90e2">→</div><div style="flex:1;background-color:white;padding:10px;border-radius:5px;border:1px solid #ddd;min-height:80px"><div style="font-weight:bold;margin-bottom:5px;font-size:14px">Side-Relative Transformation</div><pre style="margin:0;white-space:pre-wrap">sameSideImbalance = 1 - 0.75 = 0.25
(low value indicates unfavorable book condition for this sell order)</pre></div></div><div style="font-size:14px;color:#666;font-style:italic;margin-top:8px"><strong>Trading Insight:</strong> Converting raw order book imbalance to a side-relative metric creates a consistent feature that indicates favorable/unfavorable market conditions regardless of whether the iceberg is a buy or sell.</div></div><div style="margin-top:30px"><h4>Example 2: Support/Resistance Level Positioning</h4><div style="display:flex;align-items:center;margin:15px 0;gap:15px"><div style="flex:1;background-color:white;padding:10px;border-radius:5px;border:1px solid #ddd;min-height:80px"><div style="font-weight:bold;margin-bottom:5px;font-size:14px">Raw Price Data</div><pre style="margin:0;white-space:pre-wrap">Current Price: 100.25
Recent High: 102.50
Recent Low: 98.75
TicksFromHigh: 9
TicksFromLow: 6</pre></div><div style="font-size:24px;color:#4a90e2">→</div><div style="flex:1;background-color:white;padding:10px;border-radius:5px;border:1px solid #ddd;min-height:80px"><div style="font-weight:bold;margin-bottom:5px;font-size:14px">Consider Order Side</div><pre style="margin:0;white-space:pre-wrap">Order Type: BUY
For buy orders, support is relevant
For sell orders, resistance is relevant</pre></div><div style="font-size:24px;color:#4a90e2">→</div><div style="flex:1;background-color:white;padding:10px;border-radius:5px;border:1px solid #ddd;min-height:80px"><div style="font-weight:bold;margin-bottom:5px;font-size:14px">Side-Adjusted Feature</div><pre style="margin:0;white-space:pre-wrap">ticksFromSupportLevel = 6
(buy order is 6 ticks from support level)
ticksFromResistanceLevel = 9
(buy order is 9 ticks from resistance)</pre></div></div><div style="font-size:14px;color:#666;font-style:italic;margin-top:8px"><strong>Trading Insight:</strong> Buy orders are more likely to be filled when close to support levels, while sell orders are more likely to be filled when close to resistance levels. This transformation captures that market dynamic in a consistent way.</div></div></div></div></div>
</body>
</html>